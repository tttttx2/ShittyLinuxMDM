NOTE: EDUCATIONAL (AND INSECURE) PROJECT ONLY, DO NOT USE THIS IN PRODUCTION!!!


# ShittyLinuxMDM

This project creates a simple management interface, which allows to uniformly manage multiple linux machines. The web based management interface allows for the simple onboarding and offboarding of endpoints, and allows you to have a rough overview of script deployment or execution failures.

![Screenshot](/screenshot.png?raw=true "Screenshot")


# How does it work? / General Usage
After the installation is completed, visit the management interface and create a new endpoint. Simply enter a new ID (e.g. 1) and press "NEW" on the manage_endpoints menu on http://localhost:8080/#endpoints. This creates a new endpoint configuration and prepares everything necessary for onboarding a client. After this, visit the onboarding menu point, get the onboarding script URL, and run it (as root) on the client.

The onboarding script will deploy a client script, which checks in every 5 minutes and runs the provided scripts. Currently there's nothing defined yet, so let's do this on http://localhost:8080/#scripts. Once again, enter a new ID to create a script, then edit the script and enter whatever commands you like. (if you simply want to test if everything works, true is a great command that returns a successful execution.)

Now wait for the regular (5min) execution, and check the endpoint status on the manage_endpoints page on http://localhost:8080/#endpoints --> There you'll see the hostname, external IP address, last checkin timestamp, as well as the status of the last script execution.


# API
All real "business" logic of the application is contained within plugins and the underlying framework automatically generates the API swagger documentation for the currently provisioned plugins. After installation, the swagger UI is directly available at http://localhost:8080/swagger

Note: The swagger documentation might not be completely accurate yet for all edge cases (e.g. return values, required fields)

The API itself can be split into two parts: The API of the underlying framework, and the "business logic" contained within the plugins.

## Framework Endpoints
The framework exposes the following HTTP Endpoints:

- /
  - This endpoint is responsible for providing the index.html file.

- /static
  - This endpoint is used to serve static files (e.g. the web client)

- /doc
  - This endpoint returns some environment variables (e.g. used for the client footer)

- /swagger
  - This endpoint simply redirects you to the statically hosted Swagger UI files located in /static/swagger. It's unnecessary, but convenient ;)

- /swagger.json
  - This endpoint returns the autogenerated swagger configuration file.

- /plugins
  - This endpoint returns a list of available plugins. The client uses this to create the "tabs" in the navbar.

- /plugins/<path:plugin>
  - This endpoint returns a list of available features of a specific plugin. The client uses this to create the plugin specific menu items in the left sidebar.

- /plugins/<path:plugin>/<path:feature>
  - This is where all the routing magic happens. The API is based on the CRUD principle - Create, Read, Update, Delete. Depending on the HTTP request method (POST,GET,PUT,DELETE), the specific create(), read(), update(), or delete() functions of the specified plugin feature are called.


## Business Logic Endpoints
- /plugins/scripts/manage_scripts
  - This endpoint accepts requests that allow the creation, updating, reading, and deleting of individual scripts. Scripts are stored as files within the /data/scripts directory mounted as a docker volume.

- /plugins/endpoints/manage_endpoints
  - This endpoint accepts requests that allow the creation, updating, reading, and deleting of endpoints (linux machines). Their current config are stored as files within the /data/endpoints directory mounted as a docker volume.

- /plugins/endpoints/onboarding
  - This endpoint returns a list of all endpoints that can be onboarded (configured, but no data got delivered yet). It further provides a URL to access the onboarding script.
  - The onboarding script installs a cronjob entry as root, as well as deploys the mdm client script to /opt/mdm.sh.

- /plugins/endpoints/offboarding
  - This endpoint returns a list of all endpoints that are onboarded and can thus be offboarded if you suddenly decide to hate this project. It further provides a URL to access the offboarding script.
  - The offboarding script removes the cronjob entry, as well as the mdm client script.



# Installation
Use the following docker-compose.yml file for installation (the one in the repo is for local development purposes only). Ensure you edit the MDM_URL environment variable to suit your needs.
```
services:
  ssp:
    image: tttttx2/shittylinuxmdm:main
    ports:
      - "8080:8080"
    volumes:
      - ./data:/data
    environment:
      - MDM_URL=http://localhost:8080
```

Access the management interface to enroll endpoints on http://localhost:8080/#endpoints

# Development
This project is based on a quite "hacky" framework which is still in internal development - all non-framework related code is located in the `app/plugins` directory!

